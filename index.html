<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Bernardo - Completo v10</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background: #0f172a; color: white; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .container { background: #1e293b; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); text-align: center; width: 550px; max-height: 90vh; overflow-y: auto; }
        input, textarea { width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid #334155; background: #0f172a; color: white; box-sizing: border-box; }
        .btn-login, .botao { background: #38bdf8; color: #0f172a; border: none; width: 100%; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.3s; margin-top: 10px; }
        #tela-cadastro, #tela-hub, #tela-financas, #tela-estudos, #tela-assuntos, #tela-detalhes { display: none; }
        table { width: 100%; margin-top: 20px; border-collapse: collapse; background: #0f172a; border-radius: 8px; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid #334155; font-size: 0.8rem; }
        th { color: #38bdf8; background: #1e293b; }
        .clickable { color: #38bdf8; cursor: pointer; text-decoration: underline; font-weight: bold; }
        .btn-acao { background: none; border: none; cursor: pointer; font-size: 1rem; margin: 0 2px; }
    </style>
</head>
<body>

    <div id="tela-login" class="container"> 
        <h1>Login</h1>
        <input type="text" id="usuario" placeholder="Usu√°rio">
        <input type="password" id="senha" placeholder="Senha">
        <button class="btn-login" onclick="fazerLogin()">Entrar</button>
        <button class="botao" onclick="abrirTela('tela-cadastro')" style="background: #64748b; color: white;">Cadastre-se</button>
    </div>

    <div id="tela-cadastro" class="container">
        <h1>Novo Cadastro</h1>
        <input type="text" id="cad-user" placeholder="Escolha um Usu√°rio">
        <input type="password" id="cad-senha" placeholder="Escolha uma Senha">
        <button class="botao" onclick="finalizarCadastro()">Salvar Cadastro</button>
        <button class="btn-login" style="background: #64748b; color: white;" onclick="abrirTela('tela-login')">Voltar</button>
    </div>

    <div id="tela-hub" class="container">
        <h1>Ol√°, <span id="nome-user-hub"></span>!</h1>
        <button class="botao" onclick="abrirTela('tela-financas')" style="background: #22c55e; color: white;">üí∞ Minhas Finan√ßas</button>
        <button class="botao" onclick="abrirTela('tela-estudos')" style="background: #a855f7; color: white;">üìö Meus Estudos</button>
        <button class="btn-login" style="background: #f87171; color: white; margin-top: 20px;" onclick="logout()">Sair</button>
    </div>

    <div id="tela-financas" class="container">
        <h1>üí∞ Finan√ßas</h1>
        <input type="text" id="fin-local" placeholder="Onde gastou?">
        <input type="number" id="fin-valor" placeholder="Valor (R$)">
        <button class="botao" onclick="adicionarGasto()" style="background: #22c55e; color: white;">Adicionar Gasto</button>
        <table>
            <thead><tr><th>Data</th><th>Local</th><th>Valor</th><th>A√ß√µes</th></tr></thead>
            <tbody id="tabela-financas"></tbody>
        </table>
        <h3 style="background: #334155; padding: 10px; border-radius: 8px; margin-top: 15px;">Total: <span id="fin-total" style="color: #22c55e;">R$ 0,00</span></h3>
        <button class="btn-login" onclick="abrirTela('tela-hub')">Voltar</button>
    </div>

    <div id="tela-estudos" class="container">
        <h1>üìö Minhas Mat√©rias</h1>
        <input type="text" id="nova-materia" placeholder="Ex: Matem√°tica">
        <button class="botao" onclick="adicionarMateria()" style="background: #a855f7; color: white;">Cadastrar Mat√©ria</button>
        <table>
            <thead><tr><th>Mat√©ria</th><th>A√ß√£o</th></tr></thead>
            <tbody id="corpo-materias"></tbody>
        </table>
        <button class="btn-login" onclick="abrirTela('tela-hub')">Voltar</button>
    </div>

    <div id="tela-assuntos" class="container">
        <h1 id="titulo-materia">Mat√©ria</h1>
        <input type="text" id="novo-assunto" placeholder="Assunto (ex: Fra√ß√µes)">
        <input type="date" id="data-assunto">
        <button class="botao" onclick="adicionarAssunto()">Cadastrar Assunto</button>
        <table>
            <thead><tr><th>Assunto</th><th>Data</th><th>A√ß√£o</th></tr></thead>
            <tbody id="corpo-assuntos"></tbody>
        </table>
        <button class="btn-login" onclick="abrirTela('tela-estudos')">Voltar</button>
    </div>

    <div id="tela-detalhes" class="container" style="width: 650px;">
        <h2 id="titulo-assunto">Assunto</h2>
        <p id="data-exibida"></p>
        <textarea id="texto-detalhes" style="height: 250px;" oninput="salvarDetalhes()" placeholder="Escreva aqui tudo sobre este assunto..."></textarea>
        <button class="botao" onclick="baixarAssunto()" style="background: #22c55e; color: white;">üíæ Baixar Relat√≥rio (.txt)</button>
        <button class="btn-login" onclick="abrirTela('tela-assuntos')">Salvar e Voltar</button>
    </div>

    <script>
    // BANCO DE DADOS
    let usuariosDB = JSON.parse(localStorage.getItem('usuarios')) || { "admin": "123", "bernardo": "120624" };
    let estudosDB = JSON.parse(localStorage.getItem('estudos_v3')) || {};
    let financasDB = JSON.parse(localStorage.getItem('financas_v8')) || {};
    let usuarioLogado = "";
    let matIdx = null, assIdx = null;

    function abrirTela(id) {
        document.querySelectorAll('.container').forEach(c => c.style.display = 'none');
        document.getElementById(id).style.display = 'block';
        if (id === 'tela-financas') desenharFinancas();
        if (id === 'tela-estudos') desenharMaterias();
        if (id === 'tela-assuntos') desenharAssuntos();
    }

    // LOGIN E CADASTRO
    function fazerLogin() {
        const u = document.getElementById('usuario').value.toLowerCase().trim();
        const s = document.getElementById('senha').value;
        if (usuariosDB[u] === s) { 
            usuarioLogado = u; 
            document.getElementById('nome-user-hub').innerText = u; 
            abrirTela('tela-hub'); 
        } else { alert("Usu√°rio ou senha incorretos!"); }
    }

    function finalizarCadastro() {
        const u = document.getElementById('cad-user').value.toLowerCase().trim();
        const s = document.getElementById('cad-senha').value;
        if (!u || !s) return alert("Preencha todos os campos!");
        if (usuariosDB[u]) return alert("Usu√°rio j√° existe!");
        
        usuariosDB[u] = s;
        localStorage.setItem('usuarios', JSON.stringify(usuariosDB));
        alert("Cadastro realizado com sucesso!");
        abrirTela('tela-login');
    }

    // FINAN√áAS
    function adicionarGasto() {
        const local = document.getElementById('fin-local').value;
        const valor = parseFloat(document.getElementById('fin-valor').value);
        if (!local || isNaN(valor)) return alert("Preencha local e valor!");
        if (!financasDB[usuarioLogado]) financasDB[usuarioLogado] = [];
        financasDB[usuarioLogado].push({ data: new Date().toLocaleDateString('pt-BR'), local, valor });
        localStorage.setItem('financas_v8', JSON.stringify(financasDB));
        document.getElementById('fin-local').value = ""; document.getElementById('fin-valor').value = "";
        desenharFinancas();
    }

    function desenharFinancas() {
        const corpo = document.getElementById('tabela-financas');
        let soma = 0; corpo.innerHTML = "";
        (financasDB[usuarioLogado] || []).forEach((g, i) => {
            soma += g.valor;
            corpo.innerHTML += `<tr><td>${g.data}</td><td>${g.local}</td><td>R$ ${g.valor.toFixed(2)}</td>
            <td><button class="btn-acao" onclick="editarFin(${i})">‚úèÔ∏è</button><button class="btn-acao" onclick="excluirFin(${i})">üóëÔ∏è</button></td></tr>`;
        });
        document.getElementById('fin-total').innerText = `R$ ${soma.toFixed(2)}`;
    }

    window.editarFin = (i) => {
        const novo = prompt("Novo valor:", financasDB[usuarioLogado][i].valor);
        if(novo && !isNaN(novo)) { financasDB[usuarioLogado][i].valor = parseFloat(novo); localStorage.setItem('financas_v8', JSON.stringify(financasDB)); desenharFinancas(); }
    };
    window.excluirFin = (i) => { if(confirm("Deseja excluir este gasto?")) { financasDB[usuarioLogado].splice(i, 1); localStorage.setItem('financas_v8', JSON.stringify(financasDB)); desenharFinancas(); } };

    // ESTUDOS
    function adicionarMateria() {
        const nome = document.getElementById('nova-materia').value;
        if (!nome) return;
        if (!estudosDB[usuarioLogado]) estudosDB[usuarioLogado] = [];
        estudosDB[usuarioLogado].push({ nome, assuntos: [] });
        salvarEstudos(); document.getElementById('nova-materia').value = ""; desenharMaterias();
    }

    function desenharMaterias() {
        const corpo = document.getElementById('corpo-materias'); corpo.innerHTML = "";
        (estudosDB[usuarioLogado] || []).forEach((m, i) => {
            corpo.innerHTML += `<tr><td class="clickable" onclick="entrarMateria(${i})">${m.nome}</td><td><button onclick="removerMat(${i})">üóëÔ∏è</button></td></tr>`;
        });
    }

    window.entrarMateria = (i) => { matIdx = i; document.getElementById('titulo-materia').innerText = estudosDB[usuarioLogado][i].nome; abrirTela('tela-assuntos'); };

    function adicionarAssunto() {
        const nome = document.getElementById('novo-assunto').value;
        const data = document.getElementById('data-assunto').value || "S/D";
        if (!nome) return;
        estudosDB[usuarioLogado][matIdx].assuntos.push({ nome, data, conteudo: "" });
        salvarEstudos(); desenharAssuntos();
    }

    function desenharAssuntos() {
        const corpo = document.getElementById('corpo-assuntos'); corpo.innerHTML = "";
        estudosDB[usuarioLogado][matIdx].assuntos.forEach((a, i) => {
            corpo.innerHTML += `<tr><td class="clickable" onclick="entrarAssunto(${i})">${a.nome}</td><td>${a.data}</td><td><button onclick="removerAss(${i})">üóëÔ∏è</button></td></tr>`;
        });
    }

    window.entrarAssunto = (i) => {
        assIdx = i; const a = estudosDB[usuarioLogado][matIdx].assuntos[i];
        document.getElementById('titulo-assunto').innerText = a.nome;
        document.getElementById('data-exibida').innerText = "Data: " + a.data;
        document.getElementById('texto-detalhes').value = a.conteudo;
        abrirTela('tela-detalhes');
    };

    window.salvarDetalhes = () => { estudosDB[usuarioLogado][matIdx].assuntos[assIdx].conteudo = document.getElementById('texto-detalhes').value; salvarEstudos(); };

    window.baixarAssunto = () => {
        const a = estudosDB[usuarioLogado][matIdx].assuntos[assIdx];
        const texto = `MAT√âRIA: ${estudosDB[usuarioLogado][matIdx].nome}\nASSUNTO: ${a.nome}\nDATA: ${a.data}\n\nCONTE√öDO:\n${a.conteudo}`;
        const blob = new Blob([texto], { type: "text/plain" });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob); link.download = `${a.nome}.txt`; link.click();
    };

    function salvarEstudos() { localStorage.setItem('estudos_v3', JSON.stringify(estudosDB)); }
    function logout() { location.reload(); }
    function removerMat(i) { if(confirm("Apagar mat√©ria e todos os assuntos?")) { estudosDB[usuarioLogado].splice(i, 1); salvarEstudos(); desenharMaterias(); } }
    function removerAss(i) { if(confirm("Apagar este assunto?")) { estudosDB[usuarioLogado][matIdx].assuntos.splice(i, 1); salvarEstudos(); desenharAssuntos(); } }
    </script>
</body>
</html>