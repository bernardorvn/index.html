<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Bernardo - Cloud Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

    <style>
        body { font-family: 'Inter', sans-serif; background: #0f172a; color: white; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .container { background: #1e293b; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); text-align: center; width: 550px; max-height: 90vh; overflow-y: auto; }
        input, textarea { width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid #334155; background: #0f172a; color: white; box-sizing: border-box; }
        .btn-login, .botao { background: #38bdf8; color: #0f172a; border: none; width: 100%; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.3s; margin-top: 10px; }
        #tela-cadastro, #tela-hub, #tela-financas, #tela-estudos, #tela-assuntos, #tela-detalhes, #tela-admin { display: none; }
        table { width: 100%; margin-top: 20px; border-collapse: collapse; background: #0f172a; border-radius: 8px; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid #334155; font-size: 0.8rem; }
        th { color: #38bdf8; background: #1e293b; }
        .clickable { color: #38bdf8; cursor: pointer; text-decoration: underline; font-weight: bold; }
    </style>
</head>
<body>

    <div id="tela-login" class="container"> 
        <h1>Login Cloud</h1>
        <input type="text" id="usuario" placeholder="Usu√°rio">
        <input type="password" id="senha" placeholder="Senha">
        <button class="btn-login" onclick="fazerLogin()">Entrar</button>
        <button class="botao" onclick="abrirTela('tela-cadastro')" style="background: #64748b; color: white;">Cadastre-se</button>
    </div>

    <div id="tela-cadastro" class="container">
        <h1>Novo Cadastro</h1>
        <input type="text" id="cad-user" placeholder="Usu√°rio">
        <input type="password" id="cad-senha" placeholder="Senha">
        <button class="botao" onclick="finalizarCadastro()">Salvar na Nuvem</button>
        <button class="btn-login" style="background: #64748b; color: white;" onclick="abrirTela('tela-login')">Voltar</button>
    </div>

    <div id="tela-hub" class="container">
        <h1>Ol√°, <span id="nome-user-hub"></span>!</h1>
        <button class="botao" onclick="abrirTela('tela-financas')" style="background: #22c55e; color: white;">üí∞ Finan√ßas</button>
        <button class="botao" onclick="abrirTela('tela-estudos')" style="background: #a855f7; color: white;">üìö Estudos</button>
        <button id="btn-admin-view" class="botao" onclick="abrirTela('tela-admin')" style="background: #f59e0b; color: white; display: none;">‚öôÔ∏è Admin</button>
        <button class="btn-login" style="background: #f87171; color: white; margin-top: 20px;" onclick="logout()">Sair</button>
    </div>

    <div id="tela-financas" class="container">
        <h1>üí∞ Finan√ßas</h1>
        <input type="text" id="fin-local" placeholder="Onde gastou?">
        <input type="number" id="fin-valor" placeholder="Valor">
        <button class="botao" onclick="adicionarGasto()">Adicionar Gasto</button>
        <table><thead><tr><th>Data</th><th>Local</th><th>Valor</th><th>A√ß√µes</th></tr></thead><tbody id="tabela-financas"></tbody></table>
        <h3 id="fin-total">Total: R$ 0,00</h3>
        <button class="btn-login" onclick="abrirTela('tela-hub')">Voltar</button>
    </div>

    <div id="tela-estudos" class="container">
        <h1>üìö Mat√©rias</h1>
        <input type="text" id="nova-materia" placeholder="Ex: Matem√°tica">
        <button class="botao" onclick="adicionarMateria()">Cadastrar Mat√©ria</button>
        <table><thead><tr><th>Mat√©ria</th><th>A√ß√µes</th></tr></thead><tbody id="corpo-materias"></tbody></table>
        <button class="btn-login" onclick="abrirTela('tela-hub')">Voltar</button>
    </div>

    <div id="tela-assuntos" class="container">
        <h1 id="titulo-materia"></h1>
        <input type="text" id="novo-assunto" placeholder="Assunto">
        <input type="date" id="data-assunto">
        <button class="botao" onclick="adicionarAssunto()">Cadastrar Assunto</button>
        <table><thead><tr><th>Assunto</th><th>Data</th><th>A√ß√£o</th></tr></thead><tbody id="corpo-assuntos"></tbody></table>
        <button class="btn-login" onclick="abrirTela('tela-estudos')">Voltar</button>
    </div>

    <div id="tela-detalhes" class="container" style="width: 650px;">
        <h2 id="titulo-assunto"></h2>
        <textarea id="texto-detalhes" style="height: 250px;" oninput="salvarDetalhes()" placeholder="Anota√ß√µes autom√°ticas..."></textarea>
        <button class="btn-login" onclick="abrirTela('tela-assuntos')">Voltar</button>
    </div>

    <div id="tela-admin" class="container">
        <h1>Painel Admin</h1>
        <table><thead><tr><th>Usu√°rio</th><th>Senha</th><th>A√ß√£o</th></tr></thead><tbody id="corpo-admin"></tbody></table>
        <button class="btn-login" onclick="abrirTela('tela-hub')">Voltar</button>
    </div>

    <script>
    // 1. CONFIGURA√á√ÉO DAS SUAS CHAVES (J√° preenchido conforme suas imagens)
    const firebaseConfig = {
        apiKey: "AIzaSyAgUHntWb0V0l6MoHJVxDMs5sstPSaH-lc",
        authDomain: "sistema-bernardo-1999.firebaseapp.com",
        projectId: "sistema-bernardo-1999",
        storageBucket: "sistema-bernardo-1999.firebasestorage.app",
        messagingSenderId: "1071659920638",
        appId: "1:1071659920638:web:f8843b1886ff698acf49af",
        databaseURL: "https://sistema-bernardo-1999-default-rtdb.firebaseio.com/"
    };

    // Inicializa√ß√£o
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let usuariosDB = {}, estudosDB = {}, financasDB = {};
    let usuarioLogado = "", matIdx = null, assIdx = null;

    // 2. SINCRONIZA√á√ÉO EM TEMPO REAL
    db.ref('/').on('value', (snap) => {
        const data = snap.val() || {};
        usuariosDB = data.usuarios || { "admin": "123" };
        estudosDB = data.estudos || {};
        financasDB = data.financas || {};
        if (usuarioLogado) atualizarTudo();
    });

    function abrirTela(id) {
        document.querySelectorAll('.container').forEach(c => c.style.display = 'none');
        document.getElementById(id).style.display = 'block';
        atualizarTudo();
    }

    function fazerLogin() {
        const u = document.getElementById('usuario').value.toLowerCase().trim();
        const s = document.getElementById('senha').value;
        if (usuariosDB[u] === s) {
            usuarioLogado = u;
            document.getElementById('nome-user-hub').innerText = u;
            document.getElementById('btn-admin-view').style.display = (u === 'admin') ? 'block' : 'none';
            abrirTela('tela-hub');
        } else { alert("Login inv√°lido!"); }
    }

    function finalizarCadastro() {
        const u = document.getElementById('cad-user').value.toLowerCase().trim();
        const s = document.getElementById('cad-senha').value;
        if (u && s) {
            usuariosDB[u] = s;
            db.ref('usuarios').set(usuariosDB);
            alert("Cadastro salvo na nuvem!");
            abrirTela('tela-login');
        }
    }

    function atualizarTudo() {
        desenharFinancas();
        desenharMaterias();
        if (matIdx !== null) desenharAssuntos();
        if (usuarioLogado === 'admin') desenharAdmin();
    }

    // FUN√á√ïES DE LOGICA (FINAN√áAS, ESTUDOS, ETC)
    function adicionarGasto() {
        const local = document.getElementById('fin-local').value;
        const valor = parseFloat(document.getElementById('fin-valor').value);
        if(!financasDB[usuarioLogado]) financasDB[usuarioLogado] = [];
        financasDB[usuarioLogado].push({ data: new Date().toLocaleDateString('pt-BR'), local, valor });
        db.ref('financas/' + usuarioLogado).set(financasDB[usuarioLogado]);
        document.getElementById('fin-local').value = ""; document.getElementById('fin-valor').value = "";
    }

    function desenharFinancas() {
        const corpo = document.getElementById('tabela-financas');
        let soma = 0; corpo.innerHTML = "";
        (financasDB[usuarioLogado] || []).forEach((g, i) => {
            soma += g.valor;
            corpo.innerHTML += `<tr><td>${g.data}</td><td>${g.local}</td><td>R$ ${g.valor.toFixed(2)}</td>
            <td><button onclick="excluirFin(${i})">üóëÔ∏è</button></td></tr>`;
        });
        document.getElementById('fin-total').innerText = `Total: R$ ${soma.toFixed(2)}`;
    }
    window.excluirFin = (i) => { financasDB[usuarioLogado].splice(i, 1); db.ref('financas/' + usuarioLogado).set(financasDB[usuarioLogado]); };

    function adicionarMateria() {
        const nome = document.getElementById('nova-materia').value;
        if (!estudosDB[usuarioLogado]) estudosDB[usuarioLogado] = [];
        estudosDB[usuarioLogado].push({ nome, assuntos: [] });
        db.ref('estudos/' + usuarioLogado).set(estudosDB[usuarioLogado]);
        document.getElementById('nova-materia').value = "";
    }

    function desenharMaterias() {
        const corpo = document.getElementById('corpo-materias'); corpo.innerHTML = "";
        (estudosDB[usuarioLogado] || []).forEach((m, i) => {
            corpo.innerHTML += `<tr><td class="clickable" onclick="entrarMateria(${i})">${m.nome}</td><td><button onclick="removerMat(${i})">üóëÔ∏è</button></td></tr>`;
        });
    }

    window.entrarMateria = (i) => { matIdx = i; document.getElementById('titulo-materia').innerText = estudosDB[usuarioLogado][i].nome; abrirTela('tela-assuntos'); };

    function adicionarAssunto() {
        const nome = document.getElementById('novo-assunto').value;
        const data = document.getElementById('data-assunto').value || "S/D";
        if(!estudosDB[usuarioLogado][matIdx].assuntos) estudosDB[usuarioLogado][matIdx].assuntos = [];
        estudosDB[usuarioLogado][matIdx].assuntos.push({ nome, data, conteudo: "" });
        db.ref('estudos/' + usuarioLogado).set(estudosDB[usuarioLogado]);
    }

    function desenharAssuntos() {
        const corpo = document.getElementById('corpo-assuntos'); corpo.innerHTML = "";
        (estudosDB[usuarioLogado][matIdx].assuntos || []).forEach((a, i) => {
            corpo.innerHTML += `<tr><td class="clickable" onclick="entrarAssunto(${i})">${a.nome}</td><td>${a.data}</td><td><button onclick="removerAss(${i})">üóëÔ∏è</button></td></tr>`;
        });
    }

    window.entrarAssunto = (i) => {
        assIdx = i; const a = estudosDB[usuarioLogado][matIdx].assuntos[i];
        document.getElementById('titulo-assunto').innerText = a.nome;
        document.getElementById('texto-detalhes').value = a.conteudo || "";
        abrirTela('tela-detalhes');
    };

    window.salvarDetalhes = () => {
        estudosDB[usuarioLogado][matIdx].assuntos[assIdx].conteudo = document.getElementById('texto-detalhes').value;
        db.ref('estudos/' + usuarioLogado).set(estudosDB[usuarioLogado]);
    };

    function desenharAdmin() {
        const corpo = document.getElementById('corpo-admin'); corpo.innerHTML = "";
        Object.keys(usuariosDB).forEach(u => {
            corpo.innerHTML += `<tr><td>${u}</td><td>${usuariosDB[u]}</td><td><button onclick="mudarS('${u}')">‚úèÔ∏è</button></td></tr>`;
        });
    }
    window.mudarS = (u) => { const n = prompt("Nova senha:"); if(n) { usuariosDB[u] = n; db.ref('usuarios').set(usuariosDB); } };
    function logout() { location.reload(); }
    function removerMat(i) { estudosDB[usuarioLogado].splice(i, 1); db.ref('estudos/' + usuarioLogado).set(estudosDB[usuarioLogado]); }
    function removerAss(i) { estudosDB[usuarioLogado][matIdx].assuntos.splice(i, 1); db.ref('estudos/' + usuarioLogado).set(estudosDB[usuarioLogado]); }
    </script>
</body>
</html>